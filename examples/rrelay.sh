#!/bin/bash

# GLOBALS

market="${market-"it/it"}"
ua="Mozilla/5.0 (Windows CE/6.0; ARM; fr-FR) AppleWebKit/62.0 (KHTML, like Gecko) Samsung Internet/62.0 Safari/62.0"

# mutations
# q_create_basket='{"query":"mutation CreateBasket {\n  createBasket {\n    ...BasketCommon\n    gettingAround {\n      ...GettingAroundPillar\n    }\n  }\n}\n\n\nfragment TotalCommon on PriceType {\n  total\n}\n\nfragment PriceCommon on PriceType {\n  amountWithTaxes\n  total\n  discount\n  discountCode\n}\n\nfragment ComponentCommon on ComponentType {\n  id\n  parentId\n  code\n  type\n  quantity\n  removable\n  hidden\n  price {\n    ...PriceCommon\n  }\n}\n\nfragment VariantUnionAddOn on VariantUnionType {\n  ... on AddOn {\n    itemId\n    provider\n    paxNumber\n    pax\n    src\n    start\n    end\n  }\n}\n\nfragment VariantUnionFare on VariantUnionType {\n  ... on Fare {\n    fareOption\n    journeyNumber\n  }\n}\n\nfragment VariantUnionSsr on VariantUnionType {\n  ... on Ssr {\n    journeyNumber\n    paxNumber\n    segmentNumber\n  }\n}\n\nfragment VariantUnionSeat on VariantUnionType {\n  ... on Seat {\n    paxNumber\n    journeyNumber\n    segmentNumber\n    seatType\n    designator\n    childSeatsWithAdult\n    hasAdditionalSeatCost\n    primeIncluded\n  }\n}\n\nfragment VariantUnionBundle on VariantUnionType {\n  ... on Bundle {\n    journeyNumber\n    segmentNumber\n  }\n}\n\nfragment VariantUnionParkingAddOn on VariantUnionType {\n  ... on ParkingAddOn {\n    carParkName\n    itemId\n    provider\n    paxNumber\n    pax\n    src\n    start\n    end\n  }\n}\n\nfragment VariantUnionVoucher on VariantUnionType {\n  ... on Voucher {\n    firstName\n    lastName\n    email\n  }\n}\n\nfragment VariantUnionPhysicalVoucher on VariantUnionType {\n  ... on PhysicalVoucher {\n    sequenceNumber\n    firstName\n    lastName\n    address1\n    address2\n    city\n    postalCode\n    country\n    countryName\n    scheduleDate\n    message\n  }\n}\n\nfragment VariantUnionDigitalVoucher on VariantUnionType {\n  ... on DigitalVoucher {\n    sequenceNumber\n    firstName\n    lastName\n    email\n    theme\n    scheduleDate\n    scheduleTime\n    message\n  }\n}\n\nfragment VariantUnionPhysicalVoucherShippingAddress on VariantUnionType {\n  ... on PhyscialVoucherShippingAddress {\n    address1\n    address2\n    city\n    postalCode\n    country\n    countryName\n    firstName\n    lastName\n  }\n}\n\nfragment VariantUnionChangePaxType on VariantUnionType {\n  ... on ChangePassengerType {\n    passengerNumber\n    invalidJourneys {\n      journeyNumber\n      passengers {\n        passengerNumber\n        passengerType\n      }\n    }\n    mandatorySeatPricesWithoutDiscount {\n      journeyNumber\n      passengerNumber\n      feePriceWithoutDiscount\n      cost\n    }\n  }\n}\n\nfragment VariantUnionAddInfant on VariantUnionType {\n  ... on AddInfant {\n    journeyNumber\n    invalidPassengers {\n      passengerNumber\n      passengerType\n    }\n    segmentNumber\n    paxNumber\n  }\n}\n\nfragment VariantGroundTransfer on VariantUnionType {\n  ... on GroundTransfer {\n    locationPickUp\n    locationDropOff\n    routeType\n    startDate\n    endDate\n    itemId\n    location\n  }\n}\n\nfragment GettingTherePillar on GettingThereType {\n  isPrime\n  price {\n    ...TotalCommon\n  }\n  journeys {\n    ... on JourneyType {\n      arrival\n      departure\n      destination\n      duration\n      fareClass\n      fareKey\n      fareOption\n      flightKey\n      flightNumber\n      isConnecting\n      isDomestic\n      journeyNum\n      origin\n      changeInfo {\n        ... on ChangeInfoType {\n          isChangeable\n          freeMove\n          isChanged\n        }\n      }\n      segments {\n        ... on SegmentType {\n          aircraft\n          arrival\n          departure\n          destination\n          duration\n          hasGovernmentTax\n          flightNumber\n          segmentNum\n          origin\n          originCountry\n          destinationCountry\n        }\n      }\n    }\n  }\n  discounts {\n    ... on DiscountType {\n      amount\n      code\n      journeyNum\n      percentage\n      zone\n      description\n      qty\n    }\n  }\n  taxes {\n    ... on TaxType {\n      amount\n      code\n      journeyNum\n      percentage\n      zone\n    }\n  }\n  vouchers {\n    ... on VoucherType {\n      amount\n      code\n      status\n      accountNumber\n      voucherBasisCode\n    }\n  }\n  components {\n    ... on ComponentType {\n      ...ComponentCommon\n      variant {\n        ...VariantUnionAddOn\n        ...VariantUnionFare\n        ...VariantUnionSsr\n        ...VariantUnionSeat\n        ...VariantGroundTransfer\n        ...VariantUnionBundle\n        ...VariantUnionParkingAddOn\n        ...VariantUnionVoucher\n        ...VariantUnionDigitalVoucher\n        ...VariantUnionPhysicalVoucher\n        ...VariantUnionPhysicalVoucherShippingAddress\n        ...VariantUnionChangePaxType\n        ...VariantUnionAddInfant\n      }\n    }\n  }\n  messages {\n    ... on MessageType {\n      type\n      journeyNum\n      key\n      message\n    }\n  }\n}\n\nfragment PayLaterCommon on PriceType {\n  total\n}\n\nfragment BasketCommon on BasketType {\n  id\n  tripId\n  dotrezSessionId\n  currency\n  gettingThere {\n    ...GettingTherePillar\n  }\n  price {\n    ...TotalCommon\n  }\n  payLater {\n    ...PayLaterCommon\n  }\n  totalToPay\n}\n\nfragment VariantCar on VariantUnionType {\n  ... on Car {\n    rentPrice\n    carName\n    refId\n    engineLoadId\n    pickUpTime\n    pickUpLocation {\n      countryCode\n      code\n      name\n    }\n    dropOffTime\n    dropOffLocation {\n      countryCode\n      code\n      name\n    }\n    insurance\n    extras {\n      totalPrice\n      includedInRate\n      code\n      price\n      selected\n      type\n    }\n    residence\n    age\n  }\n}\n\nfragment VariantCarRental on VariantUnionType {\n  ... on CarRental {\n    rentPrice\n    carName\n    clientId\n    refId\n    pickUpTime\n    pickUpLocation {\n      countryCode\n      code\n      name\n    }\n    dropOffTime\n    dropOffLocation {\n      countryCode\n      code\n      name\n    }\n    insurance\n    insuranceQuoteReference\n    extras {\n      code\n      includedInRate\n      payNow\n      price\n      selected\n      totalPrice\n      type\n    }\n    residence\n    age\n    language\n    searchId\n    supplier\n  }\n}\n\nfragment GettingAroundPillar on GettingAroundType {\n  price {\n    amount\n    discount\n    amountWithTaxes\n    total\n  }\n  payLater {\n    ...PayLaterCommon\n  }\n  taxes {\n    amount\n  }\n  components {\n    ...ComponentCommon\n    payLater {\n      amountWithTaxes\n      total\n    }\n    variant {\n      ...VariantCar\n      ...VariantCarRental\n      ...VariantGroundTransfer\n    }\n  }\n}\n\n","operationName":"CreateBasket"}'
# jq -nr --arg data "$m_create_basket" '$data' | jq -c 'keys'

# return 0
# ["operationName","query"]
# d_create_basket='{"data":{"createBasket":{"id":"2f3e14fa-c78a-4906-b021-d5ee4222e0db","tripId":"2f3e14fa-c78a-4906-b021-d5ee4222e0db","dotrezSessionId":null,"currency":"","gettingThere":{"isPrime":false,"price":{"total":0},"journeys":[],"discounts":[],"taxes":[],"vouchers":[],"components":[],"messages":[]},"price":{"total":0},"payLater":{"total":0},"totalToPay":0,"gettingAround":{"price":{"amount":0,"discount":0,"amountWithTaxes":0,"total":0},"payLater":{"total":0},"taxes":[],"components":[]}}}}'


# createBooking
# m_create_booking='{"query":"mutation CreateBooking($basketId: String, $createBooking: CreateBookingInput!, $culture: String!) {\n  createBooking(basketId: $basketId, createBooking: $createBooking, culture: $culture) {\n    ...BasketCommon\n  }\n}\n\n\nfragment TotalCommon on PriceType {\n  total\n}\n\nfragment PriceCommon on PriceType {\n  amountWithTaxes\n  total\n  discount\n  discountCode\n}\n\nfragment ComponentCommon on ComponentType {\n  id\n  parentId\n  code\n  type\n  quantity\n  removable\n  hidden\n  price {\n    ...PriceCommon\n  }\n}\n\nfragment VariantUnionAddOn on VariantUnionType {\n  ... on AddOn {\n    itemId\n    provider\n    paxNumber\n    pax\n    src\n    start\n    end\n  }\n}\n\nfragment VariantUnionFare on VariantUnionType {\n  ... on Fare {\n    fareOption\n    journeyNumber\n  }\n}\n\nfragment VariantUnionSsr on VariantUnionType {\n  ... on Ssr {\n    journeyNumber\n    paxNumber\n    segmentNumber\n  }\n}\n\nfragment VariantUnionSeat on VariantUnionType {\n  ... on Seat {\n    paxNumber\n    journeyNumber\n    segmentNumber\n    seatType\n    designator\n    childSeatsWithAdult\n    hasAdditionalSeatCost\n    primeIncluded\n  }\n}\n\nfragment VariantUnionBundle on VariantUnionType {\n  ... on Bundle {\n    journeyNumber\n    segmentNumber\n  }\n}\n\nfragment VariantUnionParkingAddOn on VariantUnionType {\n  ... on ParkingAddOn {\n    carParkName\n    itemId\n    provider\n    paxNumber\n    pax\n    src\n    start\n    end\n  }\n}\n\nfragment VariantUnionVoucher on VariantUnionType {\n  ... on Voucher {\n    firstName\n    lastName\n    email\n  }\n}\n\nfragment VariantUnionPhysicalVoucher on VariantUnionType {\n  ... on PhysicalVoucher {\n    sequenceNumber\n    firstName\n    lastName\n    address1\n    address2\n    city\n    postalCode\n    country\n    countryName\n    scheduleDate\n    message\n  }\n}\n\nfragment VariantUnionDigitalVoucher on VariantUnionType {\n  ... on DigitalVoucher {\n    sequenceNumber\n    firstName\n    lastName\n    email\n    theme\n    scheduleDate\n    scheduleTime\n    message\n  }\n}\n\nfragment VariantUnionPhysicalVoucherShippingAddress on VariantUnionType {\n  ... on PhyscialVoucherShippingAddress {\n    address1\n    address2\n    city\n    postalCode\n    country\n    countryName\n    firstName\n    lastName\n  }\n}\n\nfragment VariantUnionChangePaxType on VariantUnionType {\n  ... on ChangePassengerType {\n    passengerNumber\n    invalidJourneys {\n      journeyNumber\n      passengers {\n        passengerNumber\n        passengerType\n      }\n    }\n    mandatorySeatPricesWithoutDiscount {\n      journeyNumber\n      passengerNumber\n      feePriceWithoutDiscount\n      cost\n    }\n  }\n}\n\nfragment VariantUnionAddInfant on VariantUnionType {\n  ... on AddInfant {\n    journeyNumber\n    invalidPassengers {\n      passengerNumber\n      passengerType\n    }\n    segmentNumber\n    paxNumber\n  }\n}\n\nfragment VariantGroundTransfer on VariantUnionType {\n  ... on GroundTransfer {\n    locationPickUp\n    locationDropOff\n    routeType\n    startDate\n    endDate\n    itemId\n    location\n  }\n}\n\nfragment GettingTherePillar on GettingThereType {\n  isPrime\n  price {\n    ...TotalCommon\n  }\n  journeys {\n    ... on JourneyType {\n      arrival\n      departure\n      destination\n      duration\n      fareClass\n      fareKey\n      fareOption\n      flightKey\n      flightNumber\n      isConnecting\n      isDomestic\n      journeyNum\n      origin\n      changeInfo {\n        ... on ChangeInfoType {\n          isChangeable\n          freeMove\n          isChanged\n        }\n      }\n      segments {\n        ... on SegmentType {\n          aircraft\n          arrival\n          departure\n          destination\n          duration\n          hasGovernmentTax\n          flightNumber\n          segmentNum\n          origin\n          originCountry\n          destinationCountry\n        }\n      }\n    }\n  }\n  discounts {\n    ... on DiscountType {\n      amount\n      code\n      journeyNum\n      percentage\n      zone\n      description\n      qty\n    }\n  }\n  taxes {\n    ... on TaxType {\n      amount\n      code\n      journeyNum\n      percentage\n      zone\n    }\n  }\n  vouchers {\n    ... on VoucherType {\n      amount\n      code\n      status\n      accountNumber\n      voucherBasisCode\n    }\n  }\n  components {\n    ... on ComponentType {\n      ...ComponentCommon\n      variant {\n        ...VariantUnionAddOn\n        ...VariantUnionFare\n        ...VariantUnionSsr\n        ...VariantUnionSeat\n        ...VariantGroundTransfer\n        ...VariantUnionBundle\n        ...VariantUnionParkingAddOn\n        ...VariantUnionVoucher\n        ...VariantUnionDigitalVoucher\n        ...VariantUnionPhysicalVoucher\n        ...VariantUnionPhysicalVoucherShippingAddress\n        ...VariantUnionChangePaxType\n        ...VariantUnionAddInfant\n      }\n    }\n  }\n  messages {\n    ... on MessageType {\n      type\n      journeyNum\n      key\n      message\n    }\n  }\n}\n\nfragment PayLaterCommon on PriceType {\n  total\n}\n\nfragment BasketCommon on BasketType {\n  id\n  tripId\n  dotrezSessionId\n  currency\n  gettingThere {\n    ...GettingTherePillar\n  }\n  price {\n    ...TotalCommon\n  }\n  payLater {\n    ...PayLaterCommon\n  }\n  totalToPay\n}\n\n","variables":{"basketId":"2f3e14fa-c78a-4906-b021-d5ee4222e0db","createBooking":{"adults":1,"children":0,"infants":0,"teens":0,"flights":[{"fareKey":"2FGVMXHMTBPQ73LTTFGTOXOWCG23NTHUGQ7TCVFLESZKDQLXBEM7ENS336VRY76Z6HBQD7JC5UCFVDAM7CXNPGZCKD3A6SSQQLKOLF7HAGIG2KXSIVBQUBOWNEJOWJ7SE3KKZ3QV6LNPMI3KHKU5CE62TOJBWMEITNYPFA7ICELQJXW2RHBE6IGSIQDKHERC35QRM67MAHVXOLBXQNXPL7WOZPYQNG4L3YIUWW6KFRBJGON3QLUYETUFHICGF7PKYLA6Y7QIREYGGRZWDOYDFQJLJHDZ4AHEHHUZ7LAGXQHRNOAU4JMCABKRO4DED2HTJYP2HHQQOASYRENHOQ26SCMY43Q445DNVOPMB2A","flightKey":"FR~7763~ ~~ALC~10/10/2025 14:30~DUB~10/10/2025 16:25~~","fareOption":null}],"discount":0,"promoCode":""},"culture":"it-it"},"operationName":"CreateBooking"}'
# jq -nr --arg data "$m_create_booking" '$data' | jq -c 'keys'
# {"basketId":"2f3e14fa-c78a-4906-b021-d5ee4222e0db","createBooking":{"adults":1,"children":0,"infants":0,"teens":0,"flights":[{"fareKey":"2FGVMXHMTBPQ73LTTFGTOXOWCG23NTHUGQ7TCVFLESZKDQLXBEM7ENS336VRY76Z6HBQD7JC5UCFVDAM7CXNPGZCKD3A6SSQQLKOLF7HAGIG2KXSIVBQUBOWNEJOWJ7SE3KKZ3QV6LNPMI3KHKU5CE62TOJBWMEITNYPFA7ICELQJXW2RHBE6IGSIQDKHERC35QRM67MAHVXOLBXQNXPL7WOZPYQNG4L3YIUWW6KFRBJGON3QLUYETUFHICGF7PKYLA6Y7QIREYGGRZWDOYDFQJLJHDZ4AHEHHUZ7LAGXQHRNOAU4JMCABKRO4DED2HTJYP2HHQQOASYRENHOQ26SCMY43Q445DNVOPMB2A","flightKey":"FR~7763~ ~~ALC~10/10/2025 14:30~DUB~10/10/2025 16:25~~","fareOption":null}],"discount":0,"promoCode":""},"culture":"it-it"}
# ["operationName","query","variables"]

# header
# jwt: eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJCYXNrZXRJZCI6IjJmM2UxNGZhLWM3OGEtNDkwNi1iMDIxLWQ1ZWU0MjIyZTBkYiIsIlRyaXBJZCI6IjJmM2UxNGZhLWM3OGEtNDkwNi1iMDIxLWQ1ZWU0MjIyZTBkYiIsIm5iZiI6MTc1MTU0MDgyMiwiZXhwIjoxNzUxNTQ0NzIyLCJpYXQiOjE3NTE1NDA4MjJ9.LVUmrGRDbghK4EwCfndBQX98Rdkw169Ryq51k_H_adecPDqIdInNQ4Bg9Fo0Lmmm0MzEN5q4qCdjkj5UxxPNL2wN3u5xuTnLeGqXpgE6SraRVoi2itYEnLAvKFarBwDkaHfIDLC6d5RrKa_W3x6ZsIx4ILsW7slVD83qfMVvHJGZtg9zvVUKSBqY5wwDEE6ZYWo7t2qcCA21bUbpF9DaEanya9pxR0kb3cOfWp6OIayG9kTgglfe-iyexEG0fH5EyW6dXvM2ApA4vzbLrTffldGPb4Y16oi8NNl0HDbY4EQ_1ZwbqaHMU5sD255URrFDRlc_K4fAHKTw00Vq5Pnptw

# d_create_booking='{"data":{"createBooking":{"id":"2f3e14fa-c78a-4906-b021-d5ee4222e0db","tripId":"2f3e14fa-c78a-4906-b021-d5ee4222e0db","dotrezSessionId":null,"currency":"EUR","gettingThere":{"isPrime":false,"price":{"total":111.99},"journeys":[{"arrival":"2025-10-10T16:25:00","departure":"2025-10-10T14:30:00","destination":"DUB","duration":"02:55","fareClass":"W","fareKey":"2FGVMXHMTBPQ73LTTFGTOXOWCG23NTHUGQ7TCVFLESZKDQLXBEM7ENS336VRY76Z6HBQD7JC5UCFVDAM7CXNPGZCKD3A6SSQQLKOLF7HAGIG2KXSIVBQUBOWNEJOWJ7SE3KKZ3QV6LNPMI3KHKU5CE62TOJBWMEITNYPFA7ICELQJXW2RHBE6IGSIQDKHERC35QRM67MAHVXOLBXQNXPL7WOZPYQNG4L3YIUWW6KFRBJGON3QLUYETUFHICGF7PKYLA6Y7QIREYGGRZWDOYDFQJLJHDZ4AHEHHUZ7LAGXQHRNOAU4JMCABKRO4DED2HTJYP2HHQQOASYRENHOQ26SCMY43Q445DNVOPMB2A","fareOption":null,"flightKey":"FR~7763~ ~~ALC~10/10/2025 14:30~DUB~10/10/2025 16:25~~","flightNumber":"FR7763","isConnecting":false,"isDomestic":false,"journeyNum":0,"origin":"ALC","changeInfo":{"isChangeable":false,"freeMove":false,"isChanged":false},"segments":[{"aircraft":"","arrival":"2025-10-10T16:25:00","departure":"2025-10-10T14:30:00","destination":"DUB","duration":"02:55","hasGovernmentTax":false,"flightNumber":"FR7763","segmentNum":0,"origin":"ALC","originCountry":"ES","destinationCountry":"IE"}]}],"discounts":[],"taxes":[],"vouchers":[],"components":[{"id":"455b8555-be62-40e0-85df-ccd5cd564766","parentId":null,"code":"ADT","type":"FARE","quantity":1,"removable":false,"hidden":false,"price":{"amountWithTaxes":111.99,"total":111.99,"discount":0,"discountCode":null},"variant":{"fareOption":"REGULAR","journeyNumber":0}}],"messages":[]},"price":{"total":111.99},"payLater":{"total":0},"totalToPay":111.99}}}'
# jq -nr --arg data "$d_create_booking" '$data' | jq -c 'keys'
# ["data"]

# CommitBooking
# m_commit_booking='{"query":"mutation CommitBooking($basketId: String!) {\n  commitBooking(basketId: $basketId) {\n    ...BasketCommon\n  }\n}\n\n\nfragment TotalCommon on PriceType {\n  total\n}\n\nfragment PriceCommon on PriceType {\n  amountWithTaxes\n  total\n  discount\n  discountCode\n}\n\nfragment ComponentCommon on ComponentType {\n  id\n  parentId\n  code\n  type\n  quantity\n  removable\n  hidden\n  price {\n    ...PriceCommon\n  }\n}\n\nfragment VariantUnionAddOn on VariantUnionType {\n  ... on AddOn {\n    itemId\n    provider\n    paxNumber\n    pax\n    src\n    start\n    end\n  }\n}\n\nfragment VariantUnionFare on VariantUnionType {\n  ... on Fare {\n    fareOption\n    journeyNumber\n  }\n}\n\nfragment VariantUnionSsr on VariantUnionType {\n  ... on Ssr {\n    journeyNumber\n    paxNumber\n    segmentNumber\n  }\n}\n\nfragment VariantUnionSeat on VariantUnionType {\n  ... on Seat {\n    paxNumber\n    journeyNumber\n    segmentNumber\n    seatType\n    designator\n    childSeatsWithAdult\n    hasAdditionalSeatCost\n    primeIncluded\n  }\n}\n\nfragment VariantUnionBundle on VariantUnionType {\n  ... on Bundle {\n    journeyNumber\n    segmentNumber\n  }\n}\n\nfragment VariantUnionParkingAddOn on VariantUnionType {\n  ... on ParkingAddOn {\n    carParkName\n    itemId\n    provider\n    paxNumber\n    pax\n    src\n    start\n    end\n  }\n}\n\nfragment VariantUnionVoucher on VariantUnionType {\n  ... on Voucher {\n    firstName\n    lastName\n    email\n  }\n}\n\nfragment VariantUnionPhysicalVoucher on VariantUnionType {\n  ... on PhysicalVoucher {\n    sequenceNumber\n    firstName\n    lastName\n    address1\n    address2\n    city\n    postalCode\n    country\n    countryName\n    scheduleDate\n    message\n  }\n}\n\nfragment VariantUnionDigitalVoucher on VariantUnionType {\n  ... on DigitalVoucher {\n    sequenceNumber\n    firstName\n    lastName\n    email\n    theme\n    scheduleDate\n    scheduleTime\n    message\n  }\n}\n\nfragment VariantUnionPhysicalVoucherShippingAddress on VariantUnionType {\n  ... on PhyscialVoucherShippingAddress {\n    address1\n    address2\n    city\n    postalCode\n    country\n    countryName\n    firstName\n    lastName\n  }\n}\n\nfragment VariantUnionChangePaxType on VariantUnionType {\n  ... on ChangePassengerType {\n    passengerNumber\n    invalidJourneys {\n      journeyNumber\n      passengers {\n        passengerNumber\n        passengerType\n      }\n    }\n    mandatorySeatPricesWithoutDiscount {\n      journeyNumber\n      passengerNumber\n      feePriceWithoutDiscount\n      cost\n    }\n  }\n}\n\nfragment VariantUnionAddInfant on VariantUnionType {\n  ... on AddInfant {\n    journeyNumber\n    invalidPassengers {\n      passengerNumber\n      passengerType\n    }\n    segmentNumber\n    paxNumber\n  }\n}\n\nfragment VariantGroundTransfer on VariantUnionType {\n  ... on GroundTransfer {\n    locationPickUp\n    locationDropOff\n    routeType\n    startDate\n    endDate\n    itemId\n    location\n  }\n}\n\nfragment GettingTherePillar on GettingThereType {\n  isPrime\n  price {\n    ...TotalCommon\n  }\n  journeys {\n    ... on JourneyType {\n      arrival\n      departure\n      destination\n      duration\n      fareClass\n      fareKey\n      fareOption\n      flightKey\n      flightNumber\n      isConnecting\n      isDomestic\n      journeyNum\n      origin\n      changeInfo {\n        ... on ChangeInfoType {\n          isChangeable\n          freeMove\n          isChanged\n        }\n      }\n      segments {\n        ... on SegmentType {\n          aircraft\n          arrival\n          departure\n          destination\n          duration\n          hasGovernmentTax\n          flightNumber\n          segmentNum\n          origin\n          originCountry\n          destinationCountry\n        }\n      }\n    }\n  }\n  discounts {\n    ... on DiscountType {\n      amount\n      code\n      journeyNum\n      percentage\n      zone\n      description\n      qty\n    }\n  }\n  taxes {\n    ... on TaxType {\n      amount\n      code\n      journeyNum\n      percentage\n      zone\n    }\n  }\n  vouchers {\n    ... on VoucherType {\n      amount\n      code\n      status\n      accountNumber\n      voucherBasisCode\n    }\n  }\n  components {\n    ... on ComponentType {\n      ...ComponentCommon\n      variant {\n        ...VariantUnionAddOn\n        ...VariantUnionFare\n        ...VariantUnionSsr\n        ...VariantUnionSeat\n        ...VariantGroundTransfer\n        ...VariantUnionBundle\n        ...VariantUnionParkingAddOn\n        ...VariantUnionVoucher\n        ...VariantUnionDigitalVoucher\n        ...VariantUnionPhysicalVoucher\n        ...VariantUnionPhysicalVoucherShippingAddress\n        ...VariantUnionChangePaxType\n        ...VariantUnionAddInfant\n      }\n    }\n  }\n  messages {\n    ... on MessageType {\n      type\n      journeyNum\n      key\n      message\n    }\n  }\n}\n\nfragment PayLaterCommon on PriceType {\n  total\n}\n\nfragment BasketCommon on BasketType {\n  id\n  tripId\n  dotrezSessionId\n  currency\n  gettingThere {\n    ...GettingTherePillar\n  }\n  price {\n    ...TotalCommon\n  }\n  payLater {\n    ...PayLaterCommon\n  }\n  totalToPay\n}\n\n","variables":{"basketId":"2f3e14fa-c78a-4906-b021-d5ee4222e0db"},"operationName":"CommitBooking"}'
# jq -nr --arg data "$m_commit_booking" '$data' | jq -c 'keys'
# ["operationName","query","variables"]

# d_commit_booking='{"data":{"commitBooking":{"id":"2f3e14fa-c78a-4906-b021-d5ee4222e0db","tripId":"2f3e14fa-c78a-4906-b021-d5ee4222e0db","dotrezSessionId":"wzfaqb5f113wkzy0od4yf41l","currency":"EUR","gettingThere":{"isPrime":false,"price":{"total":182.98},"journeys":[{"arrival":"2025-10-10T16:25:00","departure":"2025-10-10T14:30:00","destination":"DUB","duration":"02:55","fareClass":"W","fareKey":"2FGVMXHMTBPQ73LTTFGTOXOWCG23NTHUGQ7TCVFLESZKDQLXBEM7ENS336VRY76Z6HBQD7JC5UCFVDAM7CXNPGZCKD3A6SSQQLKOLF7HAGIG2KXSIVBQUBOWNEJOWJ7SE3KKZ3QV6LNPMI3KHKU5CE62TOJBWMEITNYPFA7ICELQJXW2RHBE6IGSIQDKHERC35QRM67MAHVXOLBXQNXPL7WOZPYQNG4L3YIUWW6KFRBJGON3QLUYETUFHICGF7PKYLA6Y7QIREYGGRZWDOYDFQJLJHDZ4AHEHHUZ7LAGXQHRNOAU4JMCABKRO4DED2HTJYP2HHQQOASYRENHOQ26SCMY43Q445DNVOPMB2A","fareOption":null,"flightKey":"FR~7763~ ~~ALC~10/10/2025 14:30~DUB~10/10/2025 16:25~~","flightNumber":"FR7763","isConnecting":false,"isDomestic":false,"journeyNum":0,"origin":"ALC","changeInfo":{"isChangeable":false,"freeMove":false,"isChanged":false},"segments":[{"aircraft":"738","arrival":"2025-10-10T16:25:00","departure":"2025-10-10T14:30:00","destination":"DUB","duration":"02:55","hasGovernmentTax":false,"flightNumber":"FR7763","segmentNum":0,"origin":"ALC","originCountry":"ES","destinationCountry":"IE"}]},{"arrival":"2025-10-11T20:05:00","departure":"2025-10-11T16:20:00","destination":"ALC","duration":"02:45","fareClass":"J","fareKey":"BVXTTSHSD37C5T56MHXKUSHPNQQEWBGQ65FGBUYKS7UOS4PIID2WW4YZZHYUF4JYR4DCKMKCYYJXK5NR25OUPQWTPEE4NARDMM2XYZ7KO3Z2SZKW7L5EAG2JZ4YHGCQPLWJG2WUJTUNV3YAJ2UEFB2RFHTZYGWSP7NV43Y57LY45DSFTHRHIYPUULHO4WOD3UOHN6PBLDLTVH45XPRZOP26J7O34I65J362TDZZ3ZY5JKMQNVTNTPT44L33IZ6CXDXJAFMM5DN65PLFZHBWAULNVMKNT22E7QZOIEP6WZQMEYV7Y5WQMFCSEXJJQEHJYABFPBIK42X6IACOMTUUUBLSQI5LZMJESX6NPR3I","fareOption":null,"flightKey":"FR~7762~ ~~DUB~10/11/2025 16:20~ALC~10/11/2025 20:05~~","flightNumber":"FR7762","isConnecting":false,"isDomestic":false,"journeyNum":1,"origin":"DUB","changeInfo":{"isChangeable":false,"freeMove":false,"isChanged":false},"segments":[{"aircraft":"738","arrival":"2025-10-11T20:05:00","departure":"2025-10-11T16:20:00","destination":"ALC","duration":"02:45","hasGovernmentTax":false,"flightNumber":"FR7762","segmentNum":0,"origin":"DUB","originCountry":"IE","destinationCountry":"ES"}]}],"discounts":[{"amount":5.0000,"code":"PD","journeyNum":1,"percentage":0,"zone":null,"description":null,"qty":0}],"taxes":[],"vouchers":[],"components":[{"id":"323c0eed-6562-48e5-9eee-1d05a9759154","parentId":null,"code":"ADT","type":"FARE","quantity":1,"removable":false,"hidden":false,"price":{"amountWithTaxes":111.99,"total":111.99,"discount":0.0,"discountCode":null},"variant":{"fareOption":"REGULAR","journeyNumber":0}},{"id":"fd5e43d3-0aa0-4d37-8d7a-874f30dd12ca","parentId":null,"code":"ADT","type":"FARE","quantity":1,"removable":false,"hidden":false,"price":{"amountWithTaxes":70.99,"total":70.99,"discount":0.0,"discountCode":null},"variant":{"fareOption":"REGULAR","journeyNumber":1}},{"id":"6a9d84c4-adab-4142-bc6a-aa9130b83a3b","parentId":"323c0eed-6562-48e5-9eee-1d05a9759154","code":"SBG","type":"SMALL_BAG","quantity":1,"removable":true,"hidden":false,"price":{"amountWithTaxes":0,"total":0,"discount":0,"discountCode":null},"variant":{"journeyNumber":0,"paxNumber":0,"segmentNumber":0}},{"id":"3d9e683e-86e5-46af-91dc-ee4a79880dad","parentId":"fd5e43d3-0aa0-4d37-8d7a-874f30dd12ca","code":"SBG","type":"SMALL_BAG","quantity":1,"removable":true,"hidden":false,"price":{"amountWithTaxes":0,"total":0,"discount":0,"discountCode":null},"variant":{"journeyNumber":1,"paxNumber":0,"segmentNumber":0}}],"messages":[]},"price":{"total":182.98},"payLater":{"total":0},"totalToPay":182.98}}}'
# jq -nr --arg data "$d_commit_booking" '$data' | jq -c 'keys'
# ["data"]


# POST https://www.ryanair.com/api/personapi/it-it/graphql

# GetPassengerMandatoryFields
# m_passengers_fields='{"query":"query GetPassengerMandatoryFields($searchCriteria: InputSearchCriteria) {\n  passengerMandatoryFields(searchCriteria: $searchCriteria) {\n      ...PassengersMandatoryFieldsResponse\n  }\n}\n\nfragment PassengersMandatoryFieldsResponse on PassengersMandatoryFieldsResponse {\n  passengers {\n    ...PassengerMandatoryFields\n  }\n}\n\nfragment PassengerMandatoryFields on PassengerMandatoryFields {\n  paxNum\n  type\n  title\n  firstName\n  firstSurname\n  secondSurname\n  first\n  last\n  middle\n  dob\n  inf {\n      ...PassengersInfantMandatoryFields\n  }\n  dobConstraints {\n      ...PassengersDobConstraints\n  }\n}\n\nfragment PassengersInfantMandatoryFields on InfantMandatoryFields {\n  firstName\n  firstSurname\n  secondSurname\n  first\n  last\n  middle\n  dob\n}\n\nfragment PassengersDobConstraints on MandatoryDateOfBirth {\n  maxAgeDays\n  maxAgeYears\n  maxDateOfBirth\n  minAgeDays\n  minAgeYears\n  minDateOfBirth\n}\n","variables":{"searchCriteria":{"adults":1,"teens":0,"children":0,"infants":0,"discountPercentage":0,"departureDate":"2025-10-10"}}}'
# jq -ncr --arg m_passengers_fields "$m_passengers_fields" '$m_passengers_fields|fromjson'
# d_passengers_fields='{"data":{"passengerMandatoryFields":{"passengers":[{"paxNum":0,"type":"ADT","title":"","firstName":"","firstSurname":null,"secondSurname":"","first":"","last":"","middle":null,"dob":null,"inf":null,"dobConstraints":null}]}}}'
# jq -ncr --arg d_passengers_fields "$d_passengers_fields" '$d_passengers_fields|fromjson'

# AddPassengers
# m_passengers_add='{"query":"mutation AddPassengers($passengers: [InputPassenger] = null, $basketId: String!) {\n  addPassengers(passengers: $passengers, basketId: $basketId) {\n    ...PassengersResponse\n  }\n}\n\nfragment PassengersResponse on PassengersResponse {\n  passengers {\n    ...PassengersPassenger\n  }\n}\n\nfragment PassengersPassenger on Passenger {\n  paxNum\n  type\n  title\n  firstName\n  firstSurname\n  secondSurname\n  first\n  last\n  middle\n  dob\n  inf {\n    ...PassengersInfant\n  }\n  specialAssistance {\n    ...PassengersPassengerPrmSsrType\n  }\n}\n\nfragment PassengersInfant on Infant {\n  firstName\n  firstSurname\n  secondSurname\n  first\n  last\n  middle\n  dob\n}\n\nfragment PassengersPassengerPrmSsrType on PassengerPrmSsrType {\n  codes\n  journeyNum\n  segmentNum\n}\n","variables":{"passengers":[{"type":"ADT","dob":null,"first":"Esther","last":"Robles Casado","middle":null,"title":"MRS","paxNum":0,"specialAssistance":[]}],"basketId":"2f3e14fa-c78a-4906-b021-d5ee4222e0db"}}'
# jq -nc --arg m_passengers_add $m_passengers_add '$m_passengers_add|fromjson'

# GetPassengers
# q_get_passwengers='{"query":"query GetPassengersQuery($basketId: String!) {\n  passengers(basketId: $basketId) {\n    ...PassengersResponse\n  }\n}\n\n\nfragment PassengersInfant on Infant {\n  first\n  middle\n  last\n  dob\n}\n\nfragment PassengersPassenger on Passenger {\n  type\n  title\n  first\n  middle\n  last\n  paxNum\n  specialAssistance {\n    codes\n    journeyNum\n    segmentNum\n  }\n  inf {\n    ...PassengersInfant\n  }\n}\n\nfragment PassengersResponse on PassengersResponse {\n  passengers {\n    ...PassengersPassenger\n  }\n}\n\n","variables":{"basketId":"2f3e14fa-c78a-4906-b021-d5ee4222e0db"}}'
# jq -ncr --arg q_get_passwengers "$q_get_passwengers" '$q_get_passwengers|fromjson'
# d_get_passengers='{"data":{"passengers":{"passengers":[{"type":"ADT","title":"MRS","first":"Esther","middle":"","last":"Robles Casado","paxNum":0,"specialAssistance":[],"inf":null}]}}}'
# jq -nrc --arg d_get_passengers "$d_get_passengers" '$d_get_passengers|fromjson'
# {"data":{"passengers":{"passengers":[{"type":"ADT","title":"MRS","first":"Esther","middle":"","last":"Robles Casado","paxNum":0,"specialAssistance":[],"inf":null}]}}}

# GetSeatsQuery
# q_get_seats='{"query":"query GetSeatsQuery($basketId: String!) {\n  seats(basketId: $basketId) {\n    ...SeatsResponse\n  }\n}\n\nfragment SeatsResponse on SeatAvailability {\n  equipmentModel\n  groups {\n    fares {\n      discount\n      originalPrice\n      paxNum\n      price\n      strikeThroughPrice\n    }\n    group\n    type\n  }\n  groupsMinPrices {\n    available\n    fares {\n      discount\n      originalPrice\n      paxNum\n      price\n    }\n    firstRow\n    type\n  }\n  includedSeatRows {\n    includedRanges {\n      end\n      start\n    }\n    paxNum\n    primeIncluded\n  }\n  journeyNum\n  prmCompanions {\n    paxNum\n  }\n  prmSeats {\n    paxNum\n    seats\n  }\n  seatsOffer {\n    price\n    seats {\n      paxNum\n      seat\n    }\n  }\n  segmentNum\n  unavailableSeats\n}\n","variables":{"basketId":"2f3e14fa-c78a-4906-b021-d5ee4222e0db"}}'
# jq -ncr --arg q_get_seats $q_get_seats '$q_get_seats|fromjson'
# d_get_seats='{"data":{"seats":[{"equipmentModel":"738","groups":[{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":30.50,"strikeThroughPrice":null}],"group":1,"type":"EXTRALEG"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":30.00,"strikeThroughPrice":null}],"group":13,"type":"EXTRALEG"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":19.50,"strikeThroughPrice":null}],"group":2,"type":"PRIORITY"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":19.00,"strikeThroughPrice":null}],"group":14,"type":"PRIORITY"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":18.50,"strikeThroughPrice":null}],"group":3,"type":"PRIORITY"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":18.00,"strikeThroughPrice":null}],"group":15,"type":"PRIORITY"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":17.50,"strikeThroughPrice":null}],"group":4,"type":"PRIORITY"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":17.00,"strikeThroughPrice":null}],"group":16,"type":"PRIORITY"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":16.50,"strikeThroughPrice":null}],"group":5,"type":"PRIORITY"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":16.00,"strikeThroughPrice":null}],"group":17,"type":"PRIORITY"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":15.50,"strikeThroughPrice":null}],"group":6,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":15.00,"strikeThroughPrice":null}],"group":18,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":14.50,"strikeThroughPrice":null}],"group":7,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":14.00,"strikeThroughPrice":null}],"group":19,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":13.50,"strikeThroughPrice":null}],"group":8,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":13.00,"strikeThroughPrice":null}],"group":20,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":12.50,"strikeThroughPrice":null}],"group":9,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":12.00,"strikeThroughPrice":null}],"group":21,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":21.50,"strikeThroughPrice":null}],"group":10,"type":"EXTRALEG"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":21.00,"strikeThroughPrice":null}],"group":22,"type":"EXTRALEG"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":11.50,"strikeThroughPrice":null}],"group":11,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":11.00,"strikeThroughPrice":null}],"group":23,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":10.50,"strikeThroughPrice":null}],"group":12,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":10.00,"strikeThroughPrice":null}],"group":24,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":11.50,"strikeThroughPrice":null}],"group":26,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":11.00,"strikeThroughPrice":null}],"group":30,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":12.50,"strikeThroughPrice":null}],"group":27,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":12.00,"strikeThroughPrice":null}],"group":31,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":13.50,"strikeThroughPrice":null}],"group":28,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":13.00,"strikeThroughPrice":null}],"group":32,"type":"STANDARD"}],"groupsMinPrices":[{"available":true,"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":21.50}],"firstRow":16,"type":"EXTRALEG"},{"available":true,"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":16.00}],"firstRow":6,"type":"PRIORITY"},{"available":true,"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":10.00}],"firstRow":21,"type":"STANDARD"}],"includedSeatRows":[{"includedRanges":[],"paxNum":0,"primeIncluded":false}],"journeyNum":0,"prmCompanions":[],"prmSeats":[],"seatsOffer":{"price":10.00,"seats":[{"paxNum":0,"seat":"24D"}]},"segmentNum":0,"unavailableSeats":["01A","01B","02A","02B","02C","02D","02E","02F","03D","03E","04A","04B","04C","05A","05B","06C","06D","06E","06F","07C","07D","11E","11F","14E","14F","15C","15D","16B","16C","16D","16E","17A","17B","17C","17D","17E","17F","18D","18E","18F","19D","21A","21B","21E","21F","22B","22C","27E","27F","29C","29D","29F","30A","30B","30C","30D","31B","31C","32A","32B"]},{"equipmentModel":"738","groups":[{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":30.50,"strikeThroughPrice":null}],"group":1,"type":"EXTRALEG"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":30.00,"strikeThroughPrice":null}],"group":13,"type":"EXTRALEG"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":19.50,"strikeThroughPrice":null}],"group":2,"type":"PRIORITY"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":19.00,"strikeThroughPrice":null}],"group":14,"type":"PRIORITY"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":18.50,"strikeThroughPrice":null}],"group":3,"type":"PRIORITY"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":18.00,"strikeThroughPrice":null}],"group":15,"type":"PRIORITY"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":17.50,"strikeThroughPrice":null}],"group":4,"type":"PRIORITY"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":17.00,"strikeThroughPrice":null}],"group":16,"type":"PRIORITY"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":16.50,"strikeThroughPrice":null}],"group":5,"type":"PRIORITY"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":16.00,"strikeThroughPrice":null}],"group":17,"type":"PRIORITY"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":15.50,"strikeThroughPrice":null}],"group":6,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":15.00,"strikeThroughPrice":null}],"group":18,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":14.50,"strikeThroughPrice":null}],"group":7,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":14.00,"strikeThroughPrice":null}],"group":19,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":13.50,"strikeThroughPrice":null}],"group":8,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":13.00,"strikeThroughPrice":null}],"group":20,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":12.50,"strikeThroughPrice":null}],"group":9,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":12.00,"strikeThroughPrice":null}],"group":21,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":21.50,"strikeThroughPrice":null}],"group":10,"type":"EXTRALEG"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":21.00,"strikeThroughPrice":null}],"group":22,"type":"EXTRALEG"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":11.50,"strikeThroughPrice":null}],"group":11,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":11.00,"strikeThroughPrice":null}],"group":23,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":10.50,"strikeThroughPrice":null}],"group":12,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":10.00,"strikeThroughPrice":null}],"group":24,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":11.50,"strikeThroughPrice":null}],"group":26,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":11.00,"strikeThroughPrice":null}],"group":30,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":12.50,"strikeThroughPrice":null}],"group":27,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":12.00,"strikeThroughPrice":null}],"group":31,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":13.50,"strikeThroughPrice":null}],"group":28,"type":"STANDARD"},{"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":13.00,"strikeThroughPrice":null}],"group":32,"type":"STANDARD"}],"groupsMinPrices":[{"available":true,"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":21.00}],"firstRow":16,"type":"EXTRALEG"},{"available":true,"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":16.00}],"firstRow":6,"type":"PRIORITY"},{"available":true,"fares":[{"discount":null,"originalPrice":null,"paxNum":0,"price":10.00}],"firstRow":21,"type":"STANDARD"}],"includedSeatRows":[{"includedRanges":[],"paxNum":0,"primeIncluded":false}],"journeyNum":1,"prmCompanions":[],"prmSeats":[],"seatsOffer":{"price":10.00,"seats":[{"paxNum":0,"seat":"24D"}]},"segmentNum":0,"unavailableSeats":["03C","04A","09D","09E","11E","11F","15D","18A","18B","18C","18D","18E","19B","19C","19D","19F","20A","20B","20C","20D","20E","20F","21B","21C","21D","21E","22A","22B","22C","22D","23A","23B","23C","23D","24A","24B","24C","24E","24F","25A","25B","25C","25D","25E","25F","26A","26B","26D","26E","26F","27A","27B","27E","27F","31A","32C","32D","33A","33B","33C","33D","33E"]}]}}'
# jq -ncr --arg d_get_seats $d_get_seats '$d_get_seats|fromjson'

# FligthExtrasQuery
# q_flight_extras='{"variables":{"basketId":"2f3e14fa-c78a-4906-b021-d5ee4222e0db"},"query":"query FligthExtrasQuery($basketId: String!) {\n  flightExtras(basketId: $basketId, products: [FAST, SEATS]) {\n    ...ExtraFrag\n  }\n}\n\nfragment ExtraFrag on FlightExtra {\n  code\n  maxPerPassenger\n  minPrice\n  priceDetails {\n    journeyNumber\n  }\n}\n"}'
# jq -ncr --arg q_flight_extras "$q_flight_extras" '$q_flight_extras|fromjson'
# d_flight_extras='{"data":{"flightExtras":[{"code":"SEATS","maxPerPassenger":null,"minPrice":10,"priceDetails":[{"journeyNumber":0},{"journeyNumber":1}]},{"code":"FAST","maxPerPassenger":null,"minPrice":9.99,"priceDetails":[{"journeyNumber":0},{"journeyNumber":1}]}]}}'

# AssignSeat
# m_assign_seats='{"query":"mutation AssignSeat($basketId: String!, $seats: [SeatInputType]!) {\n  assignSeat(basketId: $basketId, seats: $seats) {\n    ...BasketCommon\n  }\n}\n\n\nfragment TotalCommon on PriceType {\n  total\n}\n\nfragment PriceCommon on PriceType {\n  amountWithTaxes\n  total\n  discount\n  discountCode\n}\n\nfragment ComponentCommon on ComponentType {\n  id\n  parentId\n  code\n  type\n  quantity\n  removable\n  hidden\n  price {\n    ...PriceCommon\n  }\n}\n\nfragment VariantUnionAddOn on VariantUnionType {\n  ... on AddOn {\n    itemId\n    provider\n    paxNumber\n    pax\n    src\n    start\n    end\n  }\n}\n\nfragment VariantUnionFare on VariantUnionType {\n  ... on Fare {\n    fareOption\n    journeyNumber\n  }\n}\n\nfragment VariantUnionSsr on VariantUnionType {\n  ... on Ssr {\n    journeyNumber\n    paxNumber\n    segmentNumber\n  }\n}\n\nfragment VariantUnionSeat on VariantUnionType {\n  ... on Seat {\n    paxNumber\n    journeyNumber\n    segmentNumber\n    seatType\n    designator\n    childSeatsWithAdult\n    hasAdditionalSeatCost\n    primeIncluded\n  }\n}\n\nfragment VariantUnionBundle on VariantUnionType {\n  ... on Bundle {\n    journeyNumber\n    segmentNumber\n  }\n}\n\nfragment VariantUnionParkingAddOn on VariantUnionType {\n  ... on ParkingAddOn {\n    carParkName\n    itemId\n    provider\n    paxNumber\n    pax\n    src\n    start\n    end\n  }\n}\n\nfragment VariantUnionVoucher on VariantUnionType {\n  ... on Voucher {\n    firstName\n    lastName\n    email\n  }\n}\n\nfragment VariantUnionPhysicalVoucher on VariantUnionType {\n  ... on PhysicalVoucher {\n    sequenceNumber\n    firstName\n    lastName\n    address1\n    address2\n    city\n    postalCode\n    country\n    countryName\n    scheduleDate\n    message\n  }\n}\n\nfragment VariantUnionDigitalVoucher on VariantUnionType {\n  ... on DigitalVoucher {\n    sequenceNumber\n    firstName\n    lastName\n    email\n    theme\n    scheduleDate\n    scheduleTime\n    message\n  }\n}\n\nfragment VariantUnionPhysicalVoucherShippingAddress on VariantUnionType {\n  ... on PhyscialVoucherShippingAddress {\n    address1\n    address2\n    city\n    postalCode\n    country\n    countryName\n    firstName\n    lastName\n  }\n}\n\nfragment VariantUnionChangePaxType on VariantUnionType {\n  ... on ChangePassengerType {\n    passengerNumber\n    invalidJourneys {\n      journeyNumber\n      passengers {\n        passengerNumber\n        passengerType\n      }\n    }\n    mandatorySeatPricesWithoutDiscount {\n      journeyNumber\n      passengerNumber\n      feePriceWithoutDiscount\n      cost\n    }\n  }\n}\n\nfragment VariantUnionAddInfant on VariantUnionType {\n  ... on AddInfant {\n    journeyNumber\n    invalidPassengers {\n      passengerNumber\n      passengerType\n    }\n    segmentNumber\n    paxNumber\n  }\n}\n\nfragment VariantGroundTransfer on VariantUnionType {\n  ... on GroundTransfer {\n    locationPickUp\n    locationDropOff\n    routeType\n    startDate\n    endDate\n    itemId\n    location\n  }\n}\n\nfragment GettingTherePillar on GettingThereType {\n  isPrime\n  price {\n    ...TotalCommon\n  }\n  journeys {\n    ... on JourneyType {\n      arrival\n      departure\n      destination\n      duration\n      fareClass\n      fareKey\n      fareOption\n      flightKey\n      flightNumber\n      isConnecting\n      isDomestic\n      journeyNum\n      origin\n      changeInfo {\n        ... on ChangeInfoType {\n          isChangeable\n          freeMove\n          isChanged\n        }\n      }\n      segments {\n        ... on SegmentType {\n          aircraft\n          arrival\n          departure\n          destination\n          duration\n          hasGovernmentTax\n          flightNumber\n          segmentNum\n          origin\n          originCountry\n          destinationCountry\n        }\n      }\n    }\n  }\n  discounts {\n    ... on DiscountType {\n      amount\n      code\n      journeyNum\n      percentage\n      zone\n      description\n      qty\n    }\n  }\n  taxes {\n    ... on TaxType {\n      amount\n      code\n      journeyNum\n      percentage\n      zone\n    }\n  }\n  vouchers {\n    ... on VoucherType {\n      amount\n      code\n      status\n      accountNumber\n      voucherBasisCode\n    }\n  }\n  components {\n    ... on ComponentType {\n      ...ComponentCommon\n      variant {\n        ...VariantUnionAddOn\n        ...VariantUnionFare\n        ...VariantUnionSsr\n        ...VariantUnionSeat\n        ...VariantGroundTransfer\n        ...VariantUnionBundle\n        ...VariantUnionParkingAddOn\n        ...VariantUnionVoucher\n        ...VariantUnionDigitalVoucher\n        ...VariantUnionPhysicalVoucher\n        ...VariantUnionPhysicalVoucherShippingAddress\n        ...VariantUnionChangePaxType\n        ...VariantUnionAddInfant\n      }\n    }\n  }\n  messages {\n    ... on MessageType {\n      type\n      journeyNum\n      key\n      message\n    }\n  }\n}\n\nfragment PayLaterCommon on PriceType {\n  total\n}\n\nfragment BasketCommon on BasketType {\n  id\n  tripId\n  dotrezSessionId\n  currency\n  gettingThere {\n    ...GettingTherePillar\n  }\n  price {\n    ...TotalCommon\n  }\n  payLater {\n    ...PayLaterCommon\n  }\n  totalToPay\n}\n\n","variables":{"basketId":"2f3e14fa-c78a-4906-b021-d5ee4222e0db","seats":[{"journeyNum":0,"segmentNum":0,"paxNum":0,"designator":""},{"journeyNum":1,"segmentNum":0,"paxNum":0,"designator":""}]},"operationName":"AssignSeat"}'
# jq -ncr --arg m_assign_seats "$m_assign_seats" '$m_assign_seats|fromjson'
# d_assign_seats='{"data":{"assignSeat":{"id":"2f3e14fa-c78a-4906-b021-d5ee4222e0db","tripId":"2f3e14fa-c78a-4906-b021-d5ee4222e0db","dotrezSessionId":"wzfaqb5f113wkzy0od4yf41l","currency":"EUR","gettingThere":{"isPrime":false,"price":{"total":182.98},"journeys":[{"arrival":"2025-10-10T16:25:00","departure":"2025-10-10T14:30:00","destination":"DUB","duration":"02:55","fareClass":"W","fareKey":"2FGVMXHMTBPQ73LTTFGTOXOWCG23NTHUGQ7TCVFLESZKDQLXBEM7ENS336VRY76Z6HBQD7JC5UCFVDAM7CXNPGZCKD3A6SSQQLKOLF7HAGIG2KXSIVBQUBOWNEJOWJ7SE3KKZ3QV6LNPMI3KHKU5CE62TOJBWMEITNYPFA7ICELQJXW2RHBE6IGSIQDKHERC35QRM67MAHVXOLBXQNXPL7WOZPYQNG4L3YIUWW6KFRBJGON3QLUYETUFHICGF7PKYLA6Y7QIREYGGRZWDOYDFQJLJHDZ4AHEHHUZ7LAGXQHRNOAU4JMCABKRO4DED2HTJYP2HHQQOASYRENHOQ26SCMY43Q445DNVOPMB2A","fareOption":null,"flightKey":"FR~7763~ ~~ALC~10/10/2025 14:30~DUB~10/10/2025 16:25~~","flightNumber":"FR7763","isConnecting":false,"isDomestic":false,"journeyNum":0,"origin":"ALC","changeInfo":{"isChangeable":false,"freeMove":false,"isChanged":false},"segments":[{"aircraft":"738","arrival":"2025-10-10T16:25:00","departure":"2025-10-10T14:30:00","destination":"DUB","duration":"02:55","hasGovernmentTax":false,"flightNumber":"FR7763","segmentNum":0,"origin":"ALC","originCountry":"ES","destinationCountry":"IE"}]},{"arrival":"2025-10-11T20:05:00","departure":"2025-10-11T16:20:00","destination":"ALC","duration":"02:45","fareClass":"J","fareKey":"BVXTTSHSD37C5T56MHXKUSHPNQQEWBGQ65FGBUYKS7UOS4PIID2WW4YZZHYUF4JYR4DCKMKCYYJXK5NR25OUPQWTPEE4NARDMM2XYZ7KO3Z2SZKW7L5EAG2JZ4YHGCQPLWJG2WUJTUNV3YAJ2UEFB2RFHTZYGWSP7NV43Y57LY45DSFTHRHIYPUULHO4WOD3UOHN6PBLDLTVH45XPRZOP26J7O34I65J362TDZZ3ZY5JKMQNVTNTPT44L33IZ6CXDXJAFMM5DN65PLFZHBWAULNVMKNT22E7QZOIEP6WZQMEYV7Y5WQMFCSEXJJQEHJYABFPBIK42X6IACOMTUUUBLSQI5LZMJESX6NPR3I","fareOption":null,"flightKey":"FR~7762~ ~~DUB~10/11/2025 16:20~ALC~10/11/2025 20:05~~","flightNumber":"FR7762","isConnecting":false,"isDomestic":false,"journeyNum":1,"origin":"DUB","changeInfo":{"isChangeable":false,"freeMove":false,"isChanged":false},"segments":[{"aircraft":"738","arrival":"2025-10-11T20:05:00","departure":"2025-10-11T16:20:00","destination":"ALC","duration":"02:45","hasGovernmentTax":false,"flightNumber":"FR7762","segmentNum":0,"origin":"DUB","originCountry":"IE","destinationCountry":"ES"}]}],"discounts":[{"amount":5.0000,"code":"PD","journeyNum":1,"percentage":0,"zone":null,"description":null,"qty":0}],"taxes":[],"vouchers":[],"components":[{"id":"323c0eed-6562-48e5-9eee-1d05a9759154","parentId":null,"code":"ADT","type":"FARE","quantity":1,"removable":false,"hidden":false,"price":{"amountWithTaxes":111.99,"total":111.99,"discount":0.0,"discountCode":null},"variant":{"fareOption":"REGULAR","journeyNumber":0}},{"id":"fd5e43d3-0aa0-4d37-8d7a-874f30dd12ca","parentId":null,"code":"ADT","type":"FARE","quantity":1,"removable":false,"hidden":false,"price":{"amountWithTaxes":70.99,"total":70.99,"discount":0.0,"discountCode":null},"variant":{"fareOption":"REGULAR","journeyNumber":1}},{"id":"6a9d84c4-adab-4142-bc6a-aa9130b83a3b","parentId":"323c0eed-6562-48e5-9eee-1d05a9759154","code":"SBG","type":"SMALL_BAG","quantity":1,"removable":true,"hidden":false,"price":{"amountWithTaxes":0,"total":0,"discount":0,"discountCode":null},"variant":{"journeyNumber":0,"paxNumber":0,"segmentNumber":0}},{"id":"3d9e683e-86e5-46af-91dc-ee4a79880dad","parentId":"fd5e43d3-0aa0-4d37-8d7a-874f30dd12ca","code":"SBG","type":"SMALL_BAG","quantity":1,"removable":true,"hidden":false,"price":{"amountWithTaxes":0,"total":0,"discount":0,"discountCode":null},"variant":{"journeyNumber":1,"paxNumber":0,"segmentNumber":0}}],"messages":[]},"price":{"total":182.98},"payLater":{"total":0},"totalToPay":182.98}}}'

# ProductQuery
# q_products='{"query":"query Products($basketId: String!, $productQuery: ProductQuery!, $isCheckInFlow: Boolean!) {\n  products(basketId: $basketId, productQuery: $productQuery) {\n    bags: bag {\n      ...BagFrag\n    }\n    equipments: equipment {\n      ...EquipmentFrag\n    }\n    flightExtras: flightExtra {\n      ...ExtraFrag\n    }\n    priorityBoarding {\n      ...PriorityBoardingFrag\n    }\n  }\n  excessBag(basketId: $basketId, isCheckInFlow: $isCheckInFlow) {\n    code\n    price\n    paxType\n    paxNum\n    journeyNum\n    maxPerPassenger\n    maxPerBag\n  }\n}\n\nfragment BagFrag on Bag {\n  journeyNum\n  maxPerPassenger\n  offers {\n    ...BagOfferFrag\n  }\n}\n\nfragment BagOfferFrag on BagOffer {\n  code\n  maxPerPassenger\n  price {\n    ...BagOfferPriceFrag\n  }\n}\n\nfragment BagOfferPriceFrag on BagOfferPrice {\n  discountPercentage\n  discountType\n  originalPrice\n  paxType\n  total\n  totalDiscount\n  strikeThrough\n}\n\nfragment EquipmentFrag on Equipment {\n  journeyNum\n  offers {\n    code\n    type\n    maxPerPassenger\n    availableItems\n    prices {\n      paxType\n      total\n    }\n  }\n}\n\nfragment ExtraFrag on FlightExtra {\n  code\n  discountPercentage\n  discountType\n  maxPerPassenger\n  minOriginalPrice\n  minPrice\n  totalDiscount\n  priceDetails {\n    journeyNumber\n    segmentNumber\n    minPrice\n    minOriginalPrice\n    discountType\n    totalDiscount\n    dsc\n  }\n}\n\nfragment PriorityBoardingFrag on PriorityBoarding {\n  code\n  price\n  paxType\n  journeyNumber\n  segmentNumber\n  strikeThrough\n}\n","variables":{"basketId":"2f3e14fa-c78a-4906-b021-d5ee4222e0db","productQuery":{"productTypes":["PRIOBRDNG","CBAG","BAGS","EQUIPMENT"]},"isCheckInFlow":false}}'
# jq -ncr --arg q_products "$q_products" '$q_products'
# d_products='{"data":{"products":{"bags":[{"journeyNum":0,"maxPerPassenger":3,"offers":[{"code":"BBG","maxPerPassenger":3,"price":[{"discountPercentage":null,"discountType":"None","originalPrice":32.49,"paxType":"ADT","total":32.49,"totalDiscount":0.0,"strikeThrough":null}]},{"code":"CBAG","maxPerPassenger":1,"price":[{"discountPercentage":null,"discountType":"None","originalPrice":22.49,"paxType":"ADT","total":22.49,"totalDiscount":0.0,"strikeThrough":null}]}]},{"journeyNum":1,"maxPerPassenger":3,"offers":[{"code":"BBG","maxPerPassenger":3,"price":[{"discountPercentage":null,"discountType":"None","originalPrice":28.34,"paxType":"ADT","total":28.34,"totalDiscount":0.0,"strikeThrough":null}]},{"code":"CBAG","maxPerPassenger":1,"price":[{"discountPercentage":null,"discountType":"None","originalPrice":15.74,"paxType":"ADT","total":15.74,"totalDiscount":0.0,"strikeThrough":null}]}]}],"equipments":[{"journeyNum":0,"offers":[{"code":"BABY","type":"BABY","maxPerPassenger":3,"availableItems":-1,"prices":[{"paxType":"ADT","total":15.0}]},{"code":"GOLF","type":"SPORTS","maxPerPassenger":2,"availableItems":-1,"prices":[{"paxType":"ADT","total":45.0}]},{"code":"SPRT","type":"SPORTS","maxPerPassenger":2,"availableItems":189,"prices":[{"paxType":"ADT","total":45.0}]},{"code":"SKI","type":"SPORTS","maxPerPassenger":2,"availableItems":-1,"prices":[{"paxType":"ADT","total":45.0}]},{"code":"BULK","type":"SPORTS","maxPerPassenger":2,"availableItems":20,"prices":[{"paxType":"ADT","total":60.0}]},{"code":"BIKE","type":"SPORTS","maxPerPassenger":2,"availableItems":20,"prices":[{"paxType":"ADT","total":60.0}]},{"code":"MUSC","type":"MUSIC","maxPerPassenger":2,"availableItems":-1,"prices":[{"paxType":"ADT","total":60.0}]}]},{"journeyNum":1,"offers":[{"code":"BABY","type":"BABY","maxPerPassenger":3,"availableItems":-1,"prices":[{"paxType":"ADT","total":15.0}]},{"code":"GOLF","type":"SPORTS","maxPerPassenger":2,"availableItems":-1,"prices":[{"paxType":"ADT","total":40.0}]},{"code":"SPRT","type":"SPORTS","maxPerPassenger":2,"availableItems":189,"prices":[{"paxType":"ADT","total":40.0}]},{"code":"SKI","type":"SPORTS","maxPerPassenger":2,"availableItems":-1,"prices":[{"paxType":"ADT","total":45.0}]},{"code":"BULK","type":"SPORTS","maxPerPassenger":2,"availableItems":20,"prices":[{"paxType":"ADT","total":60.0}]},{"code":"BIKE","type":"SPORTS","maxPerPassenger":2,"availableItems":20,"prices":[{"paxType":"ADT","total":60.0}]},{"code":"MUSC","type":"MUSIC","maxPerPassenger":2,"availableItems":-1,"prices":[{"paxType":"ADT","total":60.0}]}]}],"flightExtras":[{"code":"BAGS","discountPercentage":0,"discountType":"None","maxPerPassenger":3,"minOriginalPrice":0,"minPrice":28.34,"totalDiscount":0,"priceDetails":[{"journeyNumber":0,"segmentNumber":null,"minPrice":32.49,"minOriginalPrice":0,"discountType":"None","totalDiscount":0,"dsc":null},{"journeyNumber":1,"segmentNumber":null,"minPrice":28.34,"minOriginalPrice":0,"discountType":"None","totalDiscount":0,"dsc":null}]},{"code":"CBAG","discountPercentage":0,"discountType":"None","maxPerPassenger":null,"minOriginalPrice":15.74,"minPrice":15.74,"totalDiscount":0,"priceDetails":[{"journeyNumber":0,"segmentNumber":null,"minPrice":22.49,"minOriginalPrice":22.49,"discountType":"None","totalDiscount":0,"dsc":null},{"journeyNumber":1,"segmentNumber":null,"minPrice":15.74,"minOriginalPrice":15.74,"discountType":"None","totalDiscount":0,"dsc":null}]},{"code":"EQUIPMENT","discountPercentage":0,"discountType":"None","maxPerPassenger":15,"minOriginalPrice":0,"minPrice":15,"totalDiscount":0,"priceDetails":[{"journeyNumber":0,"segmentNumber":null,"minPrice":15,"minOriginalPrice":null,"discountType":"None","totalDiscount":0,"dsc":null},{"journeyNumber":1,"segmentNumber":null,"minPrice":15,"minOriginalPrice":null,"discountType":"None","totalDiscount":0,"dsc":null}]},{"code":"PRIOBRDNG","discountPercentage":0,"discountType":"None","maxPerPassenger":null,"minOriginalPrice":20.25,"minPrice":20.25,"totalDiscount":0,"priceDetails":[{"journeyNumber":0,"segmentNumber":null,"minPrice":21.5,"minOriginalPrice":21.5,"discountType":"None","totalDiscount":0,"dsc":null},{"journeyNumber":1,"segmentNumber":null,"minPrice":20.25,"minOriginalPrice":20.25,"discountType":"None","totalDiscount":0,"dsc":null}]}],"priorityBoarding":[{"code":"PS","price":21.5,"paxType":"ADT","journeyNumber":0,"segmentNumber":0,"strikeThrough":23.5},{"code":"PS","price":20.25,"paxType":"ADT","journeyNumber":1,"segmentNumber":0,"strikeThrough":22.05}]},"excessBag":[]}}'

function dashed_market() {
    local market=${1-${market}}
    local part1=$(echo "$market" | cut -d'/' -f2)
    local part2=$(echo "$market" | cut -d'/' -f1)
    echo "$part1-$part2"
}

function availability () {
    local req="$1"
    local market="${2:-$market}"
    local url=$(availability_url "$req" $market)
    local correlation_id=$(uuidgen | tr '[:upper:]' '[:lower:]')
    http-cli --url "$url" \
        --cookie "fr-correlation-id=$correlation_id" \
        --user-agent "$ua" 
}

function availability_url () {
    local request=${1:-$(cat)}
    local market="${2:-$market}"
    local dashedMkt=$(dashed_market $market)
    local adults=$(echo $request | jq -r '.adults')
    local children=$(echo $request | jq -r '.children')
    local teen=0
    local infants=$(echo $request | jq -r '.infants')
    local DateOut=$(echo $request | jq -r '.dateOut')
    local DateIn=$(echo $request | jq -r 'if .dateIn then .dateIn else "" end')
    local Origin=$(echo $request | jq -r '.origin')
    local Destination=$(echo $request | jq -r '.destination')
    local RoundTrip
    local IncludePrimeFares="false"
    if [ -n "$DateIn" ]; then
        RoundTrip="true"
    else
        RoundTrip="false"
    fi
    local url="https://www.ryanair.com/api/booking/v4/${dashedMkt}/availability?ADT=${adults}&TEEN=${teen}&CHD=${children}&INF=${infants}&Origin=${Origin}&Destination=${Destination}&promoCode=&IncludeConnectingFlights=false&DateOut=${DateOut}&DateIn=${DateIn}&FlexDaysBeforeOut=2&FlexDaysOut=2&FlexDaysBeforeIn=2&FlexDaysIn=2&RoundTrip=${RoundTrip}&IncludePrimeFares=${IncludePrimeFares}&ToUs=AGREED"
    echo "$url"
}

function booking_variables () {
    local basketID="$1"
    local request="$2"
    local fligtht="$3"
    local variables=$(jq -nc --arg basketId "$basketID" --argjson request "$request" --argjson flight "$flight" --arg culture "$culture"  \
    '{ basketId: $basketId } + 
    { createBooking: ($request | { adults, children, infants, teens  } +
        { flights: [  { 
            flightKey: $flight.flightKey,
            fareKey: $flight.regularFare.fareKey,
            fareOption: null } ],
            discount: 0,
            promoCode: ""
        }),
        culture: $culture
    }')
    echo "$variables"
}

function create_basket () {
    local url="https://www.ryanair.com/api/basketapi/it-it/graphql"
    local m_create_basket='{"query":"mutation CreateBasket {\n  createBasket {\n    ...BasketCommon\n    gettingAround {\n      ...GettingAroundPillar\n    }\n  }\n}\n\n\nfragment TotalCommon on PriceType {\n  total\n}\n\nfragment PriceCommon on PriceType {\n  amountWithTaxes\n  total\n  discount\n  discountCode\n}\n\nfragment ComponentCommon on ComponentType {\n  id\n  parentId\n  code\n  type\n  quantity\n  removable\n  hidden\n  price {\n    ...PriceCommon\n  }\n}\n\nfragment VariantUnionAddOn on VariantUnionType {\n  ... on AddOn {\n    itemId\n    provider\n    paxNumber\n    pax\n    src\n    start\n    end\n  }\n}\n\nfragment VariantUnionFare on VariantUnionType {\n  ... on Fare {\n    fareOption\n    journeyNumber\n  }\n}\n\nfragment VariantUnionSsr on VariantUnionType {\n  ... on Ssr {\n    journeyNumber\n    paxNumber\n    segmentNumber\n  }\n}\n\nfragment VariantUnionSeat on VariantUnionType {\n  ... on Seat {\n    paxNumber\n    journeyNumber\n    segmentNumber\n    seatType\n    designator\n    childSeatsWithAdult\n    hasAdditionalSeatCost\n    primeIncluded\n  }\n}\n\nfragment VariantUnionBundle on VariantUnionType {\n  ... on Bundle {\n    journeyNumber\n    segmentNumber\n  }\n}\n\nfragment VariantUnionParkingAddOn on VariantUnionType {\n  ... on ParkingAddOn {\n    carParkName\n    itemId\n    provider\n    paxNumber\n    pax\n    src\n    start\n    end\n  }\n}\n\nfragment VariantUnionVoucher on VariantUnionType {\n  ... on Voucher {\n    firstName\n    lastName\n    email\n  }\n}\n\nfragment VariantUnionPhysicalVoucher on VariantUnionType {\n  ... on PhysicalVoucher {\n    sequenceNumber\n    firstName\n    lastName\n    address1\n    address2\n    city\n    postalCode\n    country\n    countryName\n    scheduleDate\n    message\n  }\n}\n\nfragment VariantUnionDigitalVoucher on VariantUnionType {\n  ... on DigitalVoucher {\n    sequenceNumber\n    firstName\n    lastName\n    email\n    theme\n    scheduleDate\n    scheduleTime\n    message\n  }\n}\n\nfragment VariantUnionPhysicalVoucherShippingAddress on VariantUnionType {\n  ... on PhyscialVoucherShippingAddress {\n    address1\n    address2\n    city\n    postalCode\n    country\n    countryName\n    firstName\n    lastName\n  }\n}\n\nfragment VariantUnionChangePaxType on VariantUnionType {\n  ... on ChangePassengerType {\n    passengerNumber\n    invalidJourneys {\n      journeyNumber\n      passengers {\n        passengerNumber\n        passengerType\n      }\n    }\n    mandatorySeatPricesWithoutDiscount {\n      journeyNumber\n      passengerNumber\n      feePriceWithoutDiscount\n      cost\n    }\n  }\n}\n\nfragment VariantUnionAddInfant on VariantUnionType {\n  ... on AddInfant {\n    journeyNumber\n    invalidPassengers {\n      passengerNumber\n      passengerType\n    }\n    segmentNumber\n    paxNumber\n  }\n}\n\nfragment VariantGroundTransfer on VariantUnionType {\n  ... on GroundTransfer {\n    locationPickUp\n    locationDropOff\n    routeType\n    startDate\n    endDate\n    itemId\n    location\n  }\n}\n\nfragment GettingTherePillar on GettingThereType {\n  isPrime\n  price {\n    ...TotalCommon\n  }\n  journeys {\n    ... on JourneyType {\n      arrival\n      departure\n      destination\n      duration\n      fareClass\n      fareKey\n      fareOption\n      flightKey\n      flightNumber\n      isConnecting\n      isDomestic\n      journeyNum\n      origin\n      changeInfo {\n        ... on ChangeInfoType {\n          isChangeable\n          freeMove\n          isChanged\n        }\n      }\n      segments {\n        ... on SegmentType {\n          aircraft\n          arrival\n          departure\n          destination\n          duration\n          hasGovernmentTax\n          flightNumber\n          segmentNum\n          origin\n          originCountry\n          destinationCountry\n        }\n      }\n    }\n  }\n  discounts {\n    ... on DiscountType {\n      amount\n      code\n      journeyNum\n      percentage\n      zone\n      description\n      qty\n    }\n  }\n  taxes {\n    ... on TaxType {\n      amount\n      code\n      journeyNum\n      percentage\n      zone\n    }\n  }\n  vouchers {\n    ... on VoucherType {\n      amount\n      code\n      status\n      accountNumber\n      voucherBasisCode\n    }\n  }\n  components {\n    ... on ComponentType {\n      ...ComponentCommon\n      variant {\n        ...VariantUnionAddOn\n        ...VariantUnionFare\n        ...VariantUnionSsr\n        ...VariantUnionSeat\n        ...VariantGroundTransfer\n        ...VariantUnionBundle\n        ...VariantUnionParkingAddOn\n        ...VariantUnionVoucher\n        ...VariantUnionDigitalVoucher\n        ...VariantUnionPhysicalVoucher\n        ...VariantUnionPhysicalVoucherShippingAddress\n        ...VariantUnionChangePaxType\n        ...VariantUnionAddInfant\n      }\n    }\n  }\n  messages {\n    ... on MessageType {\n      type\n      journeyNum\n      key\n      message\n    }\n  }\n}\n\nfragment PayLaterCommon on PriceType {\n  total\n}\n\nfragment BasketCommon on BasketType {\n  id\n  tripId\n  dotrezSessionId\n  currency\n  gettingThere {\n    ...GettingTherePillar\n  }\n  price {\n    ...TotalCommon\n  }\n  payLater {\n    ...PayLaterCommon\n  }\n  totalToPay\n}\n\nfragment VariantCar on VariantUnionType {\n  ... on Car {\n    rentPrice\n    carName\n    refId\n    engineLoadId\n    pickUpTime\n    pickUpLocation {\n      countryCode\n      code\n      name\n    }\n    dropOffTime\n    dropOffLocation {\n      countryCode\n      code\n      name\n    }\n    insurance\n    extras {\n      totalPrice\n      includedInRate\n      code\n      price\n      selected\n      type\n    }\n    residence\n    age\n  }\n}\n\nfragment VariantCarRental on VariantUnionType {\n  ... on CarRental {\n    rentPrice\n    carName\n    clientId\n    refId\n    pickUpTime\n    pickUpLocation {\n      countryCode\n      code\n      name\n    }\n    dropOffTime\n    dropOffLocation {\n      countryCode\n      code\n      name\n    }\n    insurance\n    insuranceQuoteReference\n    extras {\n      code\n      includedInRate\n      payNow\n      price\n      selected\n      totalPrice\n      type\n    }\n    residence\n    age\n    language\n    searchId\n    supplier\n  }\n}\n\nfragment GettingAroundPillar on GettingAroundType {\n  price {\n    amount\n    discount\n    amountWithTaxes\n    total\n  }\n  payLater {\n    ...PayLaterCommon\n  }\n  taxes {\n    amount\n  }\n  components {\n    ...ComponentCommon\n    payLater {\n      amountWithTaxes\n      total\n    }\n    variant {\n      ...VariantCar\n      ...VariantCarRental\n      ...VariantGroundTransfer\n    }\n  }\n}\n\n","operationName":"CreateBasket"}'
    http-cli  \
        --header 'accept: application/json, text/plain, */*' \
        --user-agent "$ua" \
        --cookie "fr-correlation-id=$correlation_id" \
        --url "$url" \
        --data "$m_create_basket" 
}

function create_booking () {
    local variables=$(echo "$1" | jq -c)
    # {
    #     "basketId": "2f3e14fa-c78a-4906-b021-d5ee4222e0db",
    #     "createBooking": {
    #         "adults": 1,
    #         "children": 0,
    #         "infants": 0,
    #         "teens": 0,
    #         "flights": [
    #         {
    #             "fareKey": "2FGVMXHMTBPQ73LTTFGTOXOWCG23NTHUGQ7TCVFLESZKDQLXBEM7ENS336VRY76Z6HBQD7JC5UCFVDAM7CXNPGZCKD3A6SSQQLKOLF7HAGIG2KXSIVBQUBOWNEJOWJ7SE3KKZ3QV6LNPMI3KHKU5CE62TOJBWMEITNYPFA7ICELQJXW2RHBE6IGSIQDKHERC35QRM67MAHVXOLBXQNXPL7WOZPYQNG4L3YIUWW6KFRBJGON3QLUYETUFHICGF7PKYLA6Y7QIREYGGRZWDOYDFQJLJHDZ4AHEHHUZ7LAGXQHRNOAU4JMCABKRO4DED2HTJYP2HHQQOASYRENHOQ26SCMY43Q445DNVOPMB2A",
    #             "flightKey": "FR~7763~ ~~ALC~10/10/2025 14:30~DUB~10/10/2025 16:25~~",
    #             "fareOption": null
    #         }
    #         ],
    #         "discount": 0,
    #         "promoCode": ""
    #     },
    #     "culture": "it-it"
    # }
    local url="https://www.ryanair.com/api/basketapi/it-it/graphql"
    local m_create_booking='{"query":"mutation CreateBooking($basketId: String, $createBooking: CreateBookingInput!, $culture: String!) {\n  createBooking(basketId: $basketId, createBooking: $createBooking, culture: $culture) {\n    ...BasketCommon\n  }\n}\n\n\nfragment TotalCommon on PriceType {\n  total\n}\n\nfragment PriceCommon on PriceType {\n  amountWithTaxes\n  total\n  discount\n  discountCode\n}\n\nfragment ComponentCommon on ComponentType {\n  id\n  parentId\n  code\n  type\n  quantity\n  removable\n  hidden\n  price {\n    ...PriceCommon\n  }\n}\n\nfragment VariantUnionAddOn on VariantUnionType {\n  ... on AddOn {\n    itemId\n    provider\n    paxNumber\n    pax\n    src\n    start\n    end\n  }\n}\n\nfragment VariantUnionFare on VariantUnionType {\n  ... on Fare {\n    fareOption\n    journeyNumber\n  }\n}\n\nfragment VariantUnionSsr on VariantUnionType {\n  ... on Ssr {\n    journeyNumber\n    paxNumber\n    segmentNumber\n  }\n}\n\nfragment VariantUnionSeat on VariantUnionType {\n  ... on Seat {\n    paxNumber\n    journeyNumber\n    segmentNumber\n    seatType\n    designator\n    childSeatsWithAdult\n    hasAdditionalSeatCost\n    primeIncluded\n  }\n}\n\nfragment VariantUnionBundle on VariantUnionType {\n  ... on Bundle {\n    journeyNumber\n    segmentNumber\n  }\n}\n\nfragment VariantUnionParkingAddOn on VariantUnionType {\n  ... on ParkingAddOn {\n    carParkName\n    itemId\n    provider\n    paxNumber\n    pax\n    src\n    start\n    end\n  }\n}\n\nfragment VariantUnionVoucher on VariantUnionType {\n  ... on Voucher {\n    firstName\n    lastName\n    email\n  }\n}\n\nfragment VariantUnionPhysicalVoucher on VariantUnionType {\n  ... on PhysicalVoucher {\n    sequenceNumber\n    firstName\n    lastName\n    address1\n    address2\n    city\n    postalCode\n    country\n    countryName\n    scheduleDate\n    message\n  }\n}\n\nfragment VariantUnionDigitalVoucher on VariantUnionType {\n  ... on DigitalVoucher {\n    sequenceNumber\n    firstName\n    lastName\n    email\n    theme\n    scheduleDate\n    scheduleTime\n    message\n  }\n}\n\nfragment VariantUnionPhysicalVoucherShippingAddress on VariantUnionType {\n  ... on PhyscialVoucherShippingAddress {\n    address1\n    address2\n    city\n    postalCode\n    country\n    countryName\n    firstName\n    lastName\n  }\n}\n\nfragment VariantUnionChangePaxType on VariantUnionType {\n  ... on ChangePassengerType {\n    passengerNumber\n    invalidJourneys {\n      journeyNumber\n      passengers {\n        passengerNumber\n        passengerType\n      }\n    }\n    mandatorySeatPricesWithoutDiscount {\n      journeyNumber\n      passengerNumber\n      feePriceWithoutDiscount\n      cost\n    }\n  }\n}\n\nfragment VariantUnionAddInfant on VariantUnionType {\n  ... on AddInfant {\n    journeyNumber\n    invalidPassengers {\n      passengerNumber\n      passengerType\n    }\n    segmentNumber\n    paxNumber\n  }\n}\n\nfragment VariantGroundTransfer on VariantUnionType {\n  ... on GroundTransfer {\n    locationPickUp\n    locationDropOff\n    routeType\n    startDate\n    endDate\n    itemId\n    location\n  }\n}\n\nfragment GettingTherePillar on GettingThereType {\n  isPrime\n  price {\n    ...TotalCommon\n  }\n  journeys {\n    ... on JourneyType {\n      arrival\n      departure\n      destination\n      duration\n      fareClass\n      fareKey\n      fareOption\n      flightKey\n      flightNumber\n      isConnecting\n      isDomestic\n      journeyNum\n      origin\n      changeInfo {\n        ... on ChangeInfoType {\n          isChangeable\n          freeMove\n          isChanged\n        }\n      }\n      segments {\n        ... on SegmentType {\n          aircraft\n          arrival\n          departure\n          destination\n          duration\n          hasGovernmentTax\n          flightNumber\n          segmentNum\n          origin\n          originCountry\n          destinationCountry\n        }\n      }\n    }\n  }\n  discounts {\n    ... on DiscountType {\n      amount\n      code\n      journeyNum\n      percentage\n      zone\n      description\n      qty\n    }\n  }\n  taxes {\n    ... on TaxType {\n      amount\n      code\n      journeyNum\n      percentage\n      zone\n    }\n  }\n  vouchers {\n    ... on VoucherType {\n      amount\n      code\n      status\n      accountNumber\n      voucherBasisCode\n    }\n  }\n  components {\n    ... on ComponentType {\n      ...ComponentCommon\n      variant {\n        ...VariantUnionAddOn\n        ...VariantUnionFare\n        ...VariantUnionSsr\n        ...VariantUnionSeat\n        ...VariantGroundTransfer\n        ...VariantUnionBundle\n        ...VariantUnionParkingAddOn\n        ...VariantUnionVoucher\n        ...VariantUnionDigitalVoucher\n        ...VariantUnionPhysicalVoucher\n        ...VariantUnionPhysicalVoucherShippingAddress\n        ...VariantUnionChangePaxType\n        ...VariantUnionAddInfant\n      }\n    }\n  }\n  messages {\n    ... on MessageType {\n      type\n      journeyNum\n      key\n      message\n    }\n  }\n}\n\nfragment PayLaterCommon on PriceType {\n  total\n}\n\nfragment BasketCommon on BasketType {\n  id\n  tripId\n  dotrezSessionId\n  currency\n  gettingThere {\n    ...GettingTherePillar\n  }\n  price {\n    ...TotalCommon\n  }\n  payLater {\n    ...PayLaterCommon\n  }\n  totalToPay\n}\n\n","variables":{"basketId":"2f3e14fa-c78a-4906-b021-d5ee4222e0db","createBooking":{"adults":1,"children":0,"infants":0,"teens":0,"flights":[{"fareKey":"2FGVMXHMTBPQ73LTTFGTOXOWCG23NTHUGQ7TCVFLESZKDQLXBEM7ENS336VRY76Z6HBQD7JC5UCFVDAM7CXNPGZCKD3A6SSQQLKOLF7HAGIG2KXSIVBQUBOWNEJOWJ7SE3KKZ3QV6LNPMI3KHKU5CE62TOJBWMEITNYPFA7ICELQJXW2RHBE6IGSIQDKHERC35QRM67MAHVXOLBXQNXPL7WOZPYQNG4L3YIUWW6KFRBJGON3QLUYETUFHICGF7PKYLA6Y7QIREYGGRZWDOYDFQJLJHDZ4AHEHHUZ7LAGXQHRNOAU4JMCABKRO4DED2HTJYP2HHQQOASYRENHOQ26SCMY43Q445DNVOPMB2A","flightKey":"FR~7763~ ~~ALC~10/10/2025 14:30~DUB~10/10/2025 16:25~~","fareOption":null}],"discount":0,"promoCode":""},"culture":"it-it"},"operationName":"CreateBooking"}'
    local data=$(
        jq -rcn  --arg m_create_booking "$m_create_booking" '$m_create_booking|fromjson' \
        | jq -rc --arg variables "$variables" '. + { variables: $variables|fromjson }'
    )
    local output=$(http-cli \
        --silent \
        --user-agent "$ua" \
        --header 'accept: application/json, text/plain, */*' \
        --cookie "fr-correlation-id=$correlation_id" \
        --data "$data" \
        --url "$url" \
        -- -D "$JWT_HANDLER"
    )
    export JWT=$(cat "$JWT_HANDLER" | grep 'jwt' | awk '{ print $2 }')
    echo "$output" | jq 
    # echo "$JWT" >&2
}

function commit_booking () {
    local basketId=${1:-$(cat)}
    local url="https://www.ryanair.com/api/basketapi/it-it/graphql"
    local m_commit_booking='{"query":"mutation CommitBooking($basketId: String!) {\n  commitBooking(basketId: $basketId) {\n    ...BasketCommon\n  }\n}\n\n\nfragment TotalCommon on PriceType {\n  total\n}\n\nfragment PriceCommon on PriceType {\n  amountWithTaxes\n  total\n  discount\n  discountCode\n}\n\nfragment ComponentCommon on ComponentType {\n  id\n  parentId\n  code\n  type\n  quantity\n  removable\n  hidden\n  price {\n    ...PriceCommon\n  }\n}\n\nfragment VariantUnionAddOn on VariantUnionType {\n  ... on AddOn {\n    itemId\n    provider\n    paxNumber\n    pax\n    src\n    start\n    end\n  }\n}\n\nfragment VariantUnionFare on VariantUnionType {\n  ... on Fare {\n    fareOption\n    journeyNumber\n  }\n}\n\nfragment VariantUnionSsr on VariantUnionType {\n  ... on Ssr {\n    journeyNumber\n    paxNumber\n    segmentNumber\n  }\n}\n\nfragment VariantUnionSeat on VariantUnionType {\n  ... on Seat {\n    paxNumber\n    journeyNumber\n    segmentNumber\n    seatType\n    designator\n    childSeatsWithAdult\n    hasAdditionalSeatCost\n    primeIncluded\n  }\n}\n\nfragment VariantUnionBundle on VariantUnionType {\n  ... on Bundle {\n    journeyNumber\n    segmentNumber\n  }\n}\n\nfragment VariantUnionParkingAddOn on VariantUnionType {\n  ... on ParkingAddOn {\n    carParkName\n    itemId\n    provider\n    paxNumber\n    pax\n    src\n    start\n    end\n  }\n}\n\nfragment VariantUnionVoucher on VariantUnionType {\n  ... on Voucher {\n    firstName\n    lastName\n    email\n  }\n}\n\nfragment VariantUnionPhysicalVoucher on VariantUnionType {\n  ... on PhysicalVoucher {\n    sequenceNumber\n    firstName\n    lastName\n    address1\n    address2\n    city\n    postalCode\n    country\n    countryName\n    scheduleDate\n    message\n  }\n}\n\nfragment VariantUnionDigitalVoucher on VariantUnionType {\n  ... on DigitalVoucher {\n    sequenceNumber\n    firstName\n    lastName\n    email\n    theme\n    scheduleDate\n    scheduleTime\n    message\n  }\n}\n\nfragment VariantUnionPhysicalVoucherShippingAddress on VariantUnionType {\n  ... on PhyscialVoucherShippingAddress {\n    address1\n    address2\n    city\n    postalCode\n    country\n    countryName\n    firstName\n    lastName\n  }\n}\n\nfragment VariantUnionChangePaxType on VariantUnionType {\n  ... on ChangePassengerType {\n    passengerNumber\n    invalidJourneys {\n      journeyNumber\n      passengers {\n        passengerNumber\n        passengerType\n      }\n    }\n    mandatorySeatPricesWithoutDiscount {\n      journeyNumber\n      passengerNumber\n      feePriceWithoutDiscount\n      cost\n    }\n  }\n}\n\nfragment VariantUnionAddInfant on VariantUnionType {\n  ... on AddInfant {\n    journeyNumber\n    invalidPassengers {\n      passengerNumber\n      passengerType\n    }\n    segmentNumber\n    paxNumber\n  }\n}\n\nfragment VariantGroundTransfer on VariantUnionType {\n  ... on GroundTransfer {\n    locationPickUp\n    locationDropOff\n    routeType\n    startDate\n    endDate\n    itemId\n    location\n  }\n}\n\nfragment GettingTherePillar on GettingThereType {\n  isPrime\n  price {\n    ...TotalCommon\n  }\n  journeys {\n    ... on JourneyType {\n      arrival\n      departure\n      destination\n      duration\n      fareClass\n      fareKey\n      fareOption\n      flightKey\n      flightNumber\n      isConnecting\n      isDomestic\n      journeyNum\n      origin\n      changeInfo {\n        ... on ChangeInfoType {\n          isChangeable\n          freeMove\n          isChanged\n        }\n      }\n      segments {\n        ... on SegmentType {\n          aircraft\n          arrival\n          departure\n          destination\n          duration\n          hasGovernmentTax\n          flightNumber\n          segmentNum\n          origin\n          originCountry\n          destinationCountry\n        }\n      }\n    }\n  }\n  discounts {\n    ... on DiscountType {\n      amount\n      code\n      journeyNum\n      percentage\n      zone\n      description\n      qty\n    }\n  }\n  taxes {\n    ... on TaxType {\n      amount\n      code\n      journeyNum\n      percentage\n      zone\n    }\n  }\n  vouchers {\n    ... on VoucherType {\n      amount\n      code\n      status\n      accountNumber\n      voucherBasisCode\n    }\n  }\n  components {\n    ... on ComponentType {\n      ...ComponentCommon\n      variant {\n        ...VariantUnionAddOn\n        ...VariantUnionFare\n        ...VariantUnionSsr\n        ...VariantUnionSeat\n        ...VariantGroundTransfer\n        ...VariantUnionBundle\n        ...VariantUnionParkingAddOn\n        ...VariantUnionVoucher\n        ...VariantUnionDigitalVoucher\n        ...VariantUnionPhysicalVoucher\n        ...VariantUnionPhysicalVoucherShippingAddress\n        ...VariantUnionChangePaxType\n        ...VariantUnionAddInfant\n      }\n    }\n  }\n  messages {\n    ... on MessageType {\n      type\n      journeyNum\n      key\n      message\n    }\n  }\n}\n\nfragment PayLaterCommon on PriceType {\n  total\n}\n\nfragment BasketCommon on BasketType {\n  id\n  tripId\n  dotrezSessionId\n  currency\n  gettingThere {\n    ...GettingTherePillar\n  }\n  price {\n    ...TotalCommon\n  }\n  payLater {\n    ...PayLaterCommon\n  }\n  totalToPay\n}\n\n","variables":{"basketId":"2f3e14fa-c78a-4906-b021-d5ee4222e0db"},"operationName":"CommitBooking"}'
    local data=$(jq -nrc --arg m_commit_booking "$m_commit_booking" '$m_commit_booking|fromjson' | jq -c  --arg basketId "$basketId" '.variables.basketId|=$basketId')
    echo "$data" | jq  >&2
    http-cli --silent \
        --url "$url" \
        --header "authorization: Bearer $JWT" \
        --header 'accept: application/json, text/plain, */*' \
        --user-agent "$ua" \
        --cookie "fr-correlation-id=$correlation_id" \
        --data "$data"
}

function catalog_products () {
    local bookingId="$1"
    local jwt="${2:-${JWT}}"
    local url="https://www.ryanair.com/api/catalogapi/it-it/graphql"
    local q_products='{"query":"query Products($basketId: String!, $productQuery: ProductQuery!, $isCheckInFlow: Boolean!) {\n  products(basketId: $basketId, productQuery: $productQuery) {\n    bags: bag {\n      ...BagFrag\n    }\n    equipments: equipment {\n      ...EquipmentFrag\n    }\n    flightExtras: flightExtra {\n      ...ExtraFrag\n    }\n    priorityBoarding {\n      ...PriorityBoardingFrag\n    }\n  }\n  excessBag(basketId: $basketId, isCheckInFlow: $isCheckInFlow) {\n    code\n    price\n    paxType\n    paxNum\n    journeyNum\n    maxPerPassenger\n    maxPerBag\n  }\n}\n\nfragment BagFrag on Bag {\n  journeyNum\n  maxPerPassenger\n  offers {\n    ...BagOfferFrag\n  }\n}\n\nfragment BagOfferFrag on BagOffer {\n  code\n  maxPerPassenger\n  price {\n    ...BagOfferPriceFrag\n  }\n}\n\nfragment BagOfferPriceFrag on BagOfferPrice {\n  discountPercentage\n  discountType\n  originalPrice\n  paxType\n  total\n  totalDiscount\n  strikeThrough\n}\n\nfragment EquipmentFrag on Equipment {\n  journeyNum\n  offers {\n    code\n    type\n    maxPerPassenger\n    availableItems\n    prices {\n      paxType\n      total\n    }\n  }\n}\n\nfragment ExtraFrag on FlightExtra {\n  code\n  discountPercentage\n  discountType\n  maxPerPassenger\n  minOriginalPrice\n  minPrice\n  totalDiscount\n  priceDetails {\n    journeyNumber\n    segmentNumber\n    minPrice\n    minOriginalPrice\n    discountType\n    totalDiscount\n    dsc\n  }\n}\n\nfragment PriorityBoardingFrag on PriorityBoarding {\n  code\n  price\n  paxType\n  journeyNumber\n  segmentNumber\n  strikeThrough\n}\n","variables":{"basketId":"2f3e14fa-c78a-4906-b021-d5ee4222e0db","productQuery":{"productTypes":["PRIOBRDNG","CBAG","BAGS","EQUIPMENT"]},"isCheckInFlow":false}}'
    local q_products_json=$(jq -ncr --arg q_products "$q_products" '$q_products|fromjson')
    # echo "bookingId:$bookingId" >&2
    echo "$q_products_json" | jq >&2
    local data=$(jq -n --arg bookingId "$bookingId" \
                --argjson query "$q_products_json" '
    $query + {
        variables: ($query.variables + {basketId: $bookingId})
    }')
    echo "$data" | jq >&2
    http-cli \
        --silent \
        --url "$url" \
        --header "authorization: Bearer $jwt" \
        --user-agent "$ua" \
        --header 'accept: application/json, text/plain, */*' \
        --cookie "fr-correlation-id=$correlation_id" \
        --data "$data"
}
